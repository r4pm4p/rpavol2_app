var S=Object.defineProperty;var k=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>k(r,typeof e!="symbol"?e+"":e,t);import{a as q,d as w,o as _,c as b,t as u,r as L,w as v,b as i,e as p,f as c,u as x,g as T,h as B}from"./index-D5bJCSK_.js";import{C as h,_ as D,a as A}from"./Password.vue_vue_type_script_setup_true_lang-GUs24Zia.js";const d=q("errors",{state:()=>({errors:{}}),actions:{setErrors(r){this.errors=JSON.parse(r)}},getters:{getErrors:r=>r.errors}});class E{constructor(){o(this,"isLoading");o(this,"isDisabled");this.isDisabled=!1,this.isLoading=!1}}const N={class:"bg-emerald-300 p-3 rounded-md hover:bg-emerald-400"},$=w({__name:"LoginButton",props:{controller:E},setup(r){const e=r;return(t,a)=>{var s;return _(),b("button",N,u((s=e.controller)!=null&&s.isLoading?"loading_icon.png":"Entrar"),1)}}});class y{}o(y,"validate",e=>{const t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;let a={},s=!1;if((e.email.length==0||e.email==null)&&(s=!0,a.email="Email cannot be empty"),(e.password.length==0||e.password==null)&&(s=!0,a.password="Password cannot be empty"),t.test(e.email)||(s=!0,a.email="Email is invalid"),e.password.length<8&&(s=!0,a.password="Password must have 8 characters at least"),s)throw new Error(JSON.stringify(a))});class z{constructor(){o(this,"email");o(this,"password");o(this,"request");o(this,"attemptToLogin",async()=>{try{return y.validate(this),await this.request.store("/login",{email:this.email,password:this.password}).then(e=>{if(e.status=="200")return this.loginWithSuccess(e.content.token)})}catch(e){e.message==="axs_error"?alert("Api respondeu com erru"):d().setErrors(e.message)}});o(this,"loginWithSuccess",e=>{this.request.setToken(e)});this.request=L().request,this.email="",this.password=""}}const Z=w({__name:"LoginView",setup(r){const e=B();v(()=>d().getErrors,()=>t(d().getErrors));const t=m=>{f.errorMessage=m.email,g.errorMessage=m.password},a=()=>{s.isDisabled=!0,s.isLoading=!0,n.attemptToLogin().then(()=>{s.isLoading=!1,s.isDisabled=!1}).finally(()=>e.push("/home"))},s=i(new E),f=i(new h),g=i(new h),n=i(new z);return(m,l)=>(_(),b("div",{class:"w-full h-full flex flex-col gap-1",onKeyup:l[0]||(l[0]=T((...C)=>n.attemptToLogin&&n.attemptToLogin(...C),["enter"]))},[p(D,{controller:f,reference:n,"reference-name":"email"},null,8,["controller","reference"]),p(A,{controller:g,reference:n,"reference-name":"password"},null,8,["controller","reference"]),l[1]||(l[1]=c("hr",null,null,-1)),p($,{controller:s,onClick:a},null,8,["controller"]),c("p",null,u(n),1),c("p",null,u(s),1),c("p",null,u(x(L)().request.getToken()),1)],32))}});export{Z as default};
